---
title: Knowledge Adaptation for Efficient Semantic Segmentation
date: 2019-05-03 19:24:09
categories:
- CV
tags:
- Semantic Segmention
- Knowledge Distillation
---

> - CVPR 2019
> - arXiv https://arxiv.org/abs/1903.04688

<!-- more -->

## Motivation
- The delemma between segmentation accuracy and efficiency.
- Existing methods adopting knowledge distillation are for image-level classification task without considering the spatial context structures and the feature maps from the teacher and student networks usually have inconsistent context and mismatched features, making the methods improper for semantic segmentation.
- Due to the limited receptive field, small models have difficulty in capturing long-term dependencies and can be statistically brittle.

## Contributions
- Propose a new knowledge distillation method for semantic segmentation by translating the teacher knowledge into  compact representations through an auto-encoder.
- Design an affinity distillation module that captures the long-term dependencies of the feature maps.
- Conduct experiments to validate the effectiveness of the proposed method.

## Methods
- **Overall network framework**
  The teacher network is frozen and outputs high resolution feature maps. The student network outpus small size of feature maps. Knowledge distillation is only enforced on the feature maps of the final convolution layers.
  <img src="Fig1.PNG" width="700"  align=center />
- **Knowledge translation and adaptation** (pixel-wise distillation)
  Translating the knowledge of the feature maps generated by the teacher network is realized through an auto-encoder. The auto-encoder is composed of three convolution layers (encoder) and three deconvolution layers (decoder) (3x3 kernel, padding 1, BN, ReLU). The convolution strides of the first convolution layer and the first deconvolution layer are set to 2. The training of the auto-encoder is completed by using a reconstruction loss:
  <img src="Fig2.PNG" width="300"  align=center />
  L1 norm is used to produce sparse representations. alpha=10E-7.
  A feature adapter is used to avoid large feature differences and adjust the channel numbers, which consists of three convolution layers (3x3 kernel, padding 1, BN, ReLU).
  The knowledge distillation loss for this part is:
  <img src="Fig3.PNG" width="300"  align=center />
  where E is the auto-encoder, I refers to the indices of all student-teacher pairs in all positions, C<sub>f</sub> is the adapter.
- **Affinity distillation module** (pair-wise distillation)
  Computing interactions between any two positions, expecting that the pixels with different labels will generate a low response and a high response for the pixels with the same labels.
  <img src="Fig4.PNG" width="300"  align=center />
  L2 loss is used to match the affinity matrix between teacher and student models:
  <img src="Fig5.PNG" width="300"  align=center />
- **Training procedure**
  <img src="Fig6.PNG" width="400"  align=center />
  beta = 50, gamma = 1

## Results
Teacher networks: Segmentation models based on ResNet-50 and Xception-41 with atrous convolution and ASPP.
Student networks: Segmentation models based on MobileNetV2 and its variants.

- **Pascal VOC 2012**
  <img src="Fig7.PNG" width="450"  align=center />
  <img src="Fig8.PNG" width="450"  align=center />
  <img src="Fig9.PNG" width="450"  align=center />
  <img src="Fig10.PNG" width="450"  align=center />
  <img src="Fig11.PNG" width="450"  align=center />
  <img src="Fig12.PNG" width="450"  align=center />
- **Cityscapes**
  <img src="Fig13.PNG" width="450"  align=center />
- **Pascal Context**
  <img src="Fig14.PNG" width="450"  align=center />

## Conclusions
- The proposed method improved the student network segmentation performance by 2%.
- The proposed method proposed a knowledge distillation approach between features with different spatial resolutions (auto-encoder + reconstruction loss).
- The two distillaiton methods could be categorized as pixel-wise distillation and pair-wise distillation.
- The knowledge distillation was only applied on the final feature maps, which might be a limitation for the improvement of segmentation accuracy.